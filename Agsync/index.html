



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Agsync - Levridge Integration Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#agsync" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Levridge Integration Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Levridge Integration Documentation
            </span>
            <span class="md-header-nav__topic">
              
                Agsync
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/LevridgeSoftware/LevridgeSoftware.github.io/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    LevridgeSoftware.github.io
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../Integration-Overview/" class="md-tabs__link md-tabs__link--active">
          Integrations
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../Deploying-Integration-Framework/" class="md-tabs__link">
          Deployment
        </a>
      
    </li>
  

      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Levridge Integration Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Levridge Integration Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/LevridgeSoftware/LevridgeSoftware.github.io/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    LevridgeSoftware.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Integrations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Integrations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Integration-Overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../D365-CRM-to-D365-F&O/" title="D365 CRM to D365 F&O" class="md-nav__link">
      D365 CRM to D365 F&O
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../D365-F&O-to-D365-CRM/" title="D365 F&O to D365 CRM" class="md-nav__link">
      D365 F&O to D365 CRM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../scale-integration/" title="Levridge Scale House" class="md-nav__link">
      Levridge Scale House
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Agsync
      </label>
    
    <a href="./" title="Agsync" class="md-nav__link md-nav__link--active">
      Agsync
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#agsync" class="md-nav__link">
    Agsync
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integration-description" class="md-nav__link">
    Integration Description
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#standard-master-data-integration" class="md-nav__link">
    Standard Master Data Integration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-uuid-master-data-integration" class="md-nav__link">
    External UUID Master Data Integration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#work-order-integration" class="md-nav__link">
    Work Order Integration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controllers" class="md-nav__link">
    Controllers
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agsync-auth-controller" class="md-nav__link">
    Agsync Auth Controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agsync-auth-test-controller" class="md-nav__link">
    Agsync Auth Test Controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agsync-order-changed-controller" class="md-nav__link">
    Agsync Order Changed Controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agsync-sync-accounts-controller" class="md-nav__link">
    Agsync Sync Accounts Controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agsync-uuid-controller" class="md-nav__link">
    Agsync UUID Controller
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Kahler/" title="Kahler" class="md-nav__link">
      Kahler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Surety/" title="Surety" class="md-nav__link">
      Surety
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../oneWeigh/" title="oneWeigh" class="md-nav__link">
      oneWeigh
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Field-Reveal/" title="Field Reveal" class="md-nav__link">
      Field Reveal
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../IntegratingCustomFields/" title="Integrating Custom Fields" class="md-nav__link">
      Integrating Custom Fields
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Deployment
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Deployment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Deploying-Integration-Framework/" title="Deploying the Integration Framework" class="md-nav__link">
      Deploying the Integration Framework
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ApplicationConfiguration/" title="Application Settings Configuration" class="md-nav__link">
      Application Settings Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../DeployingCustomFieldMappingAssemblies/" title="Deploying Custom Field Mapping Assemblies" class="md-nav__link">
      Deploying Custom Field Mapping Assemblies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../DeployingCDS/" title="Deploying CDS" class="md-nav__link">
      Deploying CDS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../print-service/" title="Print Service" class="md-nav__link">
      Print Service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-6" type="checkbox" id="nav-3-6">
    
    <label class="md-nav__link" for="nav-3-6">
      CRM Platform
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-6">
        CRM Platform
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../CRM-configuration/" title="CRM Platform Configuration" class="md-nav__link">
      CRM Platform Configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../about/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#agsync" class="md-nav__link">
    Agsync
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integration-description" class="md-nav__link">
    Integration Description
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#standard-master-data-integration" class="md-nav__link">
    Standard Master Data Integration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-uuid-master-data-integration" class="md-nav__link">
    External UUID Master Data Integration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#work-order-integration" class="md-nav__link">
    Work Order Integration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controllers" class="md-nav__link">
    Controllers
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agsync-auth-controller" class="md-nav__link">
    Agsync Auth Controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agsync-auth-test-controller" class="md-nav__link">
    Agsync Auth Test Controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agsync-order-changed-controller" class="md-nav__link">
    Agsync Order Changed Controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agsync-sync-accounts-controller" class="md-nav__link">
    Agsync Sync Accounts Controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agsync-uuid-controller" class="md-nav__link">
    Agsync UUID Controller
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/LevridgeSoftware/LevridgeSoftware.github.io/edit/master/docs/Agsync.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Agsync</h1>
                
                <!-- 
Add instance config reference
Add service bus setup reference (move from bottom)
Specify Hostfile with info for background task
Specific documentation for what Entities to setup in F&O. Include information on filtering customers, operations & sites
  -- Caveat on dependent entities will not necessarily be changed so they won't trigger change control
Add reference to azure key vault setup
Change CRM instructions to Create & Deploy CDS solution
Document Agsync JSON object
Document BOM setup in F&O
-->

<h2 id="agsync"><a class="toclink" href="#agsync">Agsync</a></h2>
<p>The scale integration is a bidirectional integration that consists of a Topic for
Master Data that goes from D365 F&amp;O to Agsync and Service Calls for Work Orders that go from 
Agsync to D365 F&amp;O. The Work Order integration utilize a background service running
in the same application as the Webhook controller so there is no
need for two integration application instances.</p>
<p>There are a few uniqe aspects to the Agsync integration that is different from other integrations:
- The Workorder integration service runs in the same app service as the controller and the Master Data integration service
- The Workorder integration service does all the transformation directly rather than using an EntityMapper
- The Workorder integration service makes a direct service call to D365 F&amp;O rather than using a data source
- We are using CDS to provide lookup services for mapping entity identifiers between systems.
- We utilize a filter on the event in F&amp;O to send only the customers 
  that need to sent from F&amp;O to Agsync.</p>
<h3 id="integration-description"><a class="toclink" href="#integration-description">Integration Description</a></h3>
<h4 id="standard-master-data-integration"><a class="toclink" href="#standard-master-data-integration">Standard Master Data Integration</a></h4>
<p>The standard master data integration configuration is shown below.</p>
<p><img alt="Agsync Master Data Integration" src="../assets/images/AgsyncMasterDataCommunicationAgsyncUUIDDiagram.jpg" title="Agsync Master Data Integration" /></p>
<h4 id="external-uuid-master-data-integration"><a class="toclink" href="#external-uuid-master-data-integration">External UUID Master Data Integration</a></h4>
<p>There is an alternate configuration that may be required when integrating with 
Field Reveal when Field Reveal is the master source for customer fields.</p>
<p>In this scenario Field Reveal will provide the UUIDs it generates so we can provide
those values to Agsync when we create the corresponding records in Agsync.</p>
<p>This scenario is complicated and should be avoided if possible. The reason it is
necessary is because when Field Reveal creates a work order in Agsync directly
it uses an old Agsync API that uses a UUID as the Sync ID. Field Reveal generates 
the UUID and needs to provide those to Levridge so they can be used when creating
the master record in Agsync.</p>
<p>In this scenario, it is imperative that the Customer and Customer Operation is not sent
from F&amp;O until they have been updated in Field Reveal and a Field created in Field Reveal.
Once a record is created in Agsync the UUID for it can not be modified.</p>
<p>The order of creation is as follows:
1. Customer and Customer Operatoin are created in FinOps.
2. Grower and Farm are created in Field Reveal and SyncIds are added in Field Reveal.
3. Field is created in Field Reveal. 
   1. This will cause a Field record to be sent from Field Reveal to the Levridge <a href="../Field-Integration/">Field controller</a>.
   2. The Field data will be placed on a service bus topic that has two subscriptions
      1. One subscription will be serviced by the FieldToCDS integration service
         1. This will use the UUID information to create a lookup record in CDS
      2. The other subscription will be serviced by the FieldToAX integration service
         1. This will create the Customer Site in FinOps
   3. When the record is created in FinOps it will trigger the event that sends the data to Agsync
      1. The creation of the Customer Site entity causes the event to be evaluated
      2. The filter that checks to make sure a Customer has an operation that has a site that corresponds to a field passes
   4. The Customer, Operation and Site are all sent to the FinOpsToAgsync service bus topic
   5. The AxToAgsync integration service receives the message and looks up the UUIDs from CDS then sends the records to Agsync for creation
   6. Agsync creates the records and sends back a GUID.
   7. The AxToAgsync integration updates CDS with the GUID values.</p>
<p>This communication diagram depicts this interaction:
<img alt="Agsync Master Data Integration External UUID" src="../assets/images/AgsyncMasterDataCommunicationExternalUUIDDiagram.jpg" title="Agsync Master Data External UUID Integration" /></p>
<h4 id="work-order-integration"><a class="toclink" href="#work-order-integration">Work Order Integration</a></h4>
<p><img alt="Agsync Workorder Integration External UUID" src="../assets/images/AgsyncOrderChangedCommunicationDiagram.jpg" title="Agsync Work Order Integration" /></p>
<h3 id="controllers"><a class="toclink" href="#controllers">Controllers</a></h3>
<h4 id="agsync-auth-controller"><a class="toclink" href="#agsync-auth-controller">Agsync Auth Controller</a></h4>
<p>The AgsyncAuth controller is used to generate a token needed to integrate with Agsync.</p>
<h4 id="agsync-auth-test-controller"><a class="toclink" href="#agsync-auth-test-controller">Agsync Auth Test Controller</a></h4>
<p>The AgsyncAuthTest controller is used to ...</p>
<h4 id="agsync-order-changed-controller"><a class="toclink" href="#agsync-order-changed-controller">Agsync Order Changed Controller</a></h4>
<p>The AgsyncOrderChanged controller is used by Agsync to send work orders as they are created or updated.
This controller will bundle the work order into a message and place it in the message topic.</p>
<h4 id="agsync-sync-accounts-controller"><a class="toclink" href="#agsync-sync-accounts-controller">Agsync Sync Accounts Controller</a></h4>
<p>The AgsyncSyncAccounts controller is used to query Agsync for master data and write the information into CDS.
This is done during go-live to populate the lookup data in CDS.</p>
<h4 id="agsync-uuid-controller"><a class="toclink" href="#agsync-uuid-controller">Agsync UUID Controller</a></h4>
<p>The AgsyncUUID controller provides UUIDs based on Sync Ids passed to the controller. This is used by 
Field Reveal to obtain the UUID from the Sync ID entered into Field Reveal.</p>
<h3 id="setup"><a class="toclink" href="#setup">Setup</a></h3>
<p>To integrate from D365 F&amp;O to Agsync you will need to:</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-topics-subscriptions-portal">Create an Azure Service bus topic</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-topics-subscriptions-portal">Create a subscription on the topic above</a></li>
<li><a href="../Configuring-Levridge-Entity-Event-Endpoint/">Configure Event Endpoint in F&amp;O</a></li>
<li><a href="../Configuring-Levridge-Entity-Events/">configure Levridge Entity Events</a></li>
<li>Create Filter on Entity Event to only send agronomy customers 
   <!-- TODO: Document how to create filter --></li>
<li>Get Client ID and CLient password from Agsync</li>
<li>Get Customer Specific Integration ID from Agsync</li>
<li>Client Redirect URL is [Azure Webapp base URL]/api/AgsyncAuth</li>
<li><a href="../AzureKeyVault/">Setup Azure Keyvault</a> </li>
<li><a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app">Create an application ID</a> for the integration framework to authenticate to D365 CRM</li>
<li><a href="https://docs.microsoft.com/en-us/dynamics365/customer-engagement/developer/use-multi-tenant-server-server-authentication#create-an-application-user--associated-with-the-registered-application--in-">Create an application user in D365 CRM</a> and assign the proper role(s)</li>
</ul>
<h3 id="configuration"><a class="toclink" href="#configuration">Configuration</a></h3>
<p>In the appsettings.json you will need to define the <a href="../InstanceConfig/">InstanceConfig</a>  <a href="../SourceConfig/">SourceConfig</a> and <a href="../TargetConfig/">TargetConfig</a> nodes as follows:</p>
<pre><code>  "InstanceConfig": {
    "AzureTableConfiguration": "[section name to Azure Table Configuration",
    "LogRequestsAndResponses": [true or false]
    "EnableAppInsightsAdaptiveSampling": [true or false]
  },
  "SourceConfig": {
    "ServiceBusConfigName": "[section name with service bus topic and subscription for Agsync Master Data]",
    "ODataConfigName": "[section name with F&amp;O data configuration]",
    "SystemName": "DynamicsAx",
    "Direction": "Source"
  },
  "TargetConfig": {
    "ODataConfigName": "[section name with Agsync endpoint configuration]",
    "CDSConfigName": "[section name with CDS data configuration]",
    "SystemName": "AgSync",
    "Direction": "Target",
  }
</code></pre>
<p>You must also include the controller entry to have the controller loaded:</p>
<pre><code>"Controllers": {
    "HostController": "Levridge.Integration.Host.DefaultController",
    "AgSyncConroller": "Levridge.Integration.Host.AgSyncController"
}
</code></pre>
<p>You must also configure two objects for Agsync integration:</p>
<ul>
<li><a href="../AgSyncEndpoint/">AgSyncEndpoint</a></li>
<li><a href="../agsyncConfigObject/">agsync</a></li>
</ul>
<p>Here is a sample template for the entire appsettings.json file used for the integration
from FinOps to Agsync:</p>
<pre><code>{
    "Controllers": {
        "HostController": "Levridge.Integration.Host.DefaultController",
        "AgSyncConroller": "Levridge.Integration.Host.AgSyncController"
    },
    "Logging": {
        "Debug": {
            "LogLevel": {
                "Default": "Information"
            }
        },
        "Console": {
            "IncludeScopes": true,
            "LogLevel": {
                "Default": "Information"
            }
        },
        "LogLevel": {
            "Default": "Information"
        }
    },
    "AllowedHosts": "*",
    "SourceConfig": {
        "ServiceBusConfigName": "AgsyncMasterDataServiceBus",
        "ODataConfigName": "DynamicsAX",
        "SystemName": "DynamicsAx",
        "Direction": "Source"
    },
    "TargetConfig": {
        "ODataConfigName": "AgSyncEndpoint",
        "SystemName": "AgSync",
        "Direction": "Target",
        "CDSConfigName": "CDS"
    },
    "DynamicsAX": {
        "UriString": "[URL to D365 F&amp;O]",
        "ActiveDirectoryResource": "[URL to D365 F&amp;O]",
        "ActiveDirectoryTenant": "https://login.microsoftonline.com/[Customer_Tenant_ID]",
        "ActiveDirectoryClientAppId": "[Application ID used to register the application in AD]",
        "ActiveDirectoryClientAppSecret": "[Client Secret generated for the Application ID in AD]",
        "ODataEntityPath": "[URL to D365 F&amp;O]/data/"
    },
    "CDS": {
        "UriString": "[URL to CDS or Localhost]",
        "ActiveDirectoryResource": "[URL to CDS]",
        "ActiveDirectoryTenant": "https://login.microsoftonline.com/[Customer_Tenant_ID]",
        "ActiveDirectoryClientAppId": "[Application ID used to register the application in AD]",
        "ActiveDirectoryClientAppSecret": "[Client Secret generated for the Application ID in AD]",
        "ODataEntityPath": "[URL to CDS]/api/data/v9.0/",
        "AssemblyName": "Levridge.ODataDataSources.CDS",
        "ClientClassesNameSpace": "Levridge.ODataDataSources.CDS",
        "MetadataResource": "CDSMetadata.xml"
    },
    "AgSyncEndpoint": {
       "MustUseWktProcessor": true,
        "baseUri": "https://fields.agsync.com/api/",
        "tokenUrl": "https://auth.agsync.com/core/connect/token",
        "ClientId": "[client ID assigned by Agsync]", // customer specific
        "ClientPass": "[Client Secret assigned by Agsync]", // customer specific
        "ValutURL": "[URL to customer Azure Key Vault]",
        "AgSyncTokenKey": "AgsyncAccessToken",
        "RedirectUri": "[URL to AgsyncAuth controller]", // customer specific
        "IntegrationId": "CustomerIntegrationID" // customer specific
    },
    "agsync": { // used by Webhook
        "MustUseWktProcessor": true,
        "ConnectionString": "[connection string to Agsync master data topic]",
        "TopicName": "[Agsync master data topic]",
        "RequiresSession": true,
        "RedirectUri": "[URL to AgsyncAuth controller]",
        "TokenUrl": "https://auth.agsync.com/core/connect/token",
        "AuthorizeUrl": "https://auth.agsync.com/core/connect/authorize",
        "baseUri": "https://fields.agsync.com/api/",
        "ClientId": "[client ID assigned by Agsync]",
        "ClientPass": "[Client Secret assigned by Agsync]",
        "ValutURL": "[URL to customer Azure Key Vault]",
        "AgSyncTokenKey": "AgsyncAccessToken"
    },
    "AgsyncMasterDataServiceBus": {
        "ConnectionString": "[connection string to Agsync master data topic]",
        "TopicName": "[Agsync master data topic]",
        "SubscriptionName": "[Agsync master data subscription name]",
        "RequiresSession": true
    }
}
</code></pre>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../scale-integration/" title="Levridge Scale House" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Levridge Scale House
              </span>
            </div>
          </a>
        
        
          <a href="../Kahler/" title="Kahler" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Kahler
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>